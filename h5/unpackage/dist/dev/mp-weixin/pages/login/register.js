(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/register"],{69:function(e,n,t){"use strict";(function(e,n){var o=t(4);t(26);o(t(25));var r=o(t(70));e.__webpack_require_UNI_MP_PLUGIN__=t,n(r.default)}).call(this,t(1)["default"],t(2)["createPage"])},70:function(e,n,t){"use strict";t.r(n);var o=t(71),r=t(73);for(var i in r)["default"].indexOf(i)<0&&function(e){t.d(n,e,(function(){return r[e]}))}(i);t(75);var s,a=t(32),u=Object(a["default"])(r["default"],o["render"],o["staticRenderFns"],!1,null,"24dc7ac2",null,!1,o["components"],s);u.options.__file="pages/login/register.vue",n["default"]=u.exports},71:function(e,n,t){"use strict";t.r(n);var o=t(72);t.d(n,"render",(function(){return o["render"]})),t.d(n,"staticRenderFns",(function(){return o["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return o["recyclableRender"]})),t.d(n,"components",(function(){return o["components"]}))},72:function(e,n,t){"use strict";var o;t.r(n),t.d(n,"render",(function(){return r})),t.d(n,"staticRenderFns",(function(){return s})),t.d(n,"recyclableRender",(function(){return i})),t.d(n,"components",(function(){return o}));try{o={uniForms:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(t.bind(null,369))},uniFormsItem:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(t.bind(null,377))},uniEasyinput:function(){return t.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(t.bind(null,111))},uniFilePicker:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(t.bind(null,384))},uniPopup:function(){return t.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(t.bind(null,92))},uniPopupMessage:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-popup/components/uni-popup-message/uni-popup-message")]).then(t.bind(null,118))}}}catch(a){if(-1===a.message.indexOf("Cannot find module")||-1===a.message.indexOf(".vue"))throw a;console.error(a.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,n=e.$createElement;e._self._c},i=!1,s=[];r._withStripped=!0},73:function(e,n,t){"use strict";t.r(n);var o=t(74),r=t.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(i);n["default"]=r.a},74:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=t(66),r={data:function(){var e=this;return{formData:{file:void 0,nickname:"",password:"",passwordConfirm:"",username:""},rules:{username:{rules:[{required:!0,errorMessage:"请输入账号"},{validateFunction:function(e,n,t,o){var r=/^\d+$/;return r.test(n)||o("账号只能是数字"),!0}}]},nickname:{rules:[{required:!0,errorMessage:"请输入昵称"}]},password:{rules:[{required:!0,errorMessage:"请输入密码"},{validateFunction:function(e,n,t,o){var r=/^(?=.*\d)(?=.*[A-z])[\da-zA-Z]{1,9}$/;return r.test(n)||o("密码只能由字母、数字组成，1-9位"),!0}}]},passwordConfirm:{rules:[{required:!0,errorMessage:"请再次输入密码"},{validateFunction:function(n,t,o,r){return new Promise((function(n,o){setTimeout((function(){t===e.formData.password?n():o(new Error("两次密码不一致"))}),100)}))}}]}},showLoading:!1,firstContent:"",secondContent:"",messageText:""}},onReady:function(){this.$refs.formData.setRules(this.rules)},onLoad:function(e){},methods:{select:function(n){var t=n.tempFiles[0].file,o=(t.type.toLowerCase(),t.size/1024/1024);o>1?e.showToast({title:"文件大小不得大于1MB",icon:"none"}):this.formData.file=n},deleteImg:function(){this.formData.file=void 0},submit:function(){var n=this;this.$refs.formData.validate().then((function(t){n.formData.file?n.register():e.showToast({title:"请选择上传头像",icon:"none"})})).catch((function(e){console.log("error",e)}))},register:function(){var n=this;this.setLoadingOptions(!0,"注册中");var t=e.getStorageSync("BASE_URL"),o="common/upload/image";e.uploadFile({url:t+o,fileType:"image",name:"file",file:this.formData.file.tempFiles[0].file,formData:{cid:1},success:function(t){var o=JSON.parse(t.data);if(console.log(o),200===o.code){var r=o.data;n.addUser(r)}else e.showToast({title:"添加失败",icon:"none"})},fail:function(n){e.showToast({title:"添加失败",icon:"none"})}})},delImg:function(e){var n=[];n.push(e.id);var t={ids:n};(0,o.delImg)(t).then((function(e){}))},addUser:function(e){var n=this,t={avatar:e.path,deptId:10,id:"",isDisable:0,isMultipoint:0,nickname:this.formData.nickname,password:this.formData.password,passwordConfirm:this.formData.passwordConfirm,role:2,sort:1,username:this.formData.username};(0,o.register)(t).then((function(t){n.setLoadingOptions(!1);var o=t.data;200===o.code?n.token():(n.messageText=o.msg,n.$refs.message.open(),n.delImg(e))}))},token:function(){var n=this;this.setLoadingOptions(!0,"注册成功，登陆中");var t={terminal:1,password:this.formData.password,username:this.formData.username};(0,o.token)(t).then((function(t){var o=t.data;200===o.code?(e.setStorageSync("token",o.data.token),n.getUserInfo()):(n.messageText="登录失败",n.$refs.message.open())}))},getUserInfo:function(){var n=this;(0,o.getUserInfo)().then((function(t){n.setLoadingOptions(!1);var o=t.data;200===o.code?(e.setStorageSync("userData",o.data.user),e.reLaunch({url:"/pages/home/index"})):(n.messageText="获取用户信息失败",n.$refs.message.open())}))},setLoadingOptions:function(e,n,t){this.showLoading=e||!1,this.firstContent=n||"",this.secondContent=t||""}}};n.default=r}).call(this,t(2)["default"])},75:function(e,n,t){"use strict";t.r(n);var o=t(76),r=t.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(i);n["default"]=r.a},76:function(e,n,t){}},[[69,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/register.js.map